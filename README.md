# sillyidea-api
This is Web API back-end built using Django, a python web framework, and deployed in a Docker container.


# FROM EMC2
If you are want to run this app on an AWS EC2 instance follow the following instructions:

NOTE: These instructions are intended for an EC2 instance to run a dockerized container for a web API and DB with some proxy support

BEFOREHAND: be able to access the EMC2 instance via SSH from the terminal of your local device or use the interactive console AWS provides

1. Create am SSH Key on your EC2 instance, this will be used to pull the repository from CodeCommit and deploy:

Run the following in your terminal and follow the prompts about location and file naming, defaults should provided and are generally fine to use
`
ssh-keygen -t rsa -b 4096
`
Output your public key to the terminal, then copy it (CTRL+C for Windows, Command+C for Mac) to your clipboard
`
cat ~/.ssh/id_rsa.pub
`
Almost done: Navigate to your IAM console and select the User or Service Account you wish to have access to CodeCommit and navigate to a tab called AWS CodeCommit credentials. Here you will see a button allowing you to upload a public SSH key, copy the public key to the text area in the modal and use the Upload button to complete. Not that the public key entered was saved, but it is not retrievable. You will observe a new line item in the list of SSH public keys for AWS CodeCommit. The random string of characters in the column labeled SSH Key ID is critical, you will need to copy it your clipboard soon.

Now we need to modify an ssh config file in the terminal of the machine that needs to clone the repo. It is likely that one does not exist, just create it. Use nano or vi to do so
`
vi ~/.ssh/config
`
Paste the following configuration into the file
`
Host git-codecommit.*.amazonaws.com
  User SSH_Key_ID_EXAMPLE
  IdentityFile ~/.ssh/id_rsa
`
Hopefully you have taken note that the user attribute will not work unless you paste in the newly created one from the list in the IAM console. Once corrected, save the file.

You can secure the file with the following
`
chmod 600 ~/.ssh/config
`
If you wish to test the SSH connectivity between device and repo, feel free
`
ssh git-codecommit.us-east-2.amazonaws.com
`
NOTE: this is paraphrased from documentation: https://docs.aws.amazon.com/codecommit/latest/userguide/setting-up-ssh-unixes.html?icmpid=docs_acc_console_connect

2. run the following commands to prepare the EC2 instance:
Basic prep of update system on Linux
`
sudo yum update
`
Install Git:
`
sudo yum install git -y
`
Install and configure system to run docker services
`
sudo yum install docker -y
sudo systemctl enable docker.service
sudo systemctl start docker.service
sudo usermod -aG docker ec2-user
`
Install and configure system to run docker-compose
`
sudo curl -L "https://github.com/docker/compose/releases/download/1.29.1/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
`
NOTE: the above may fail with the following error...

3. Clone the git repo:
`
git clone <project ssh url>
`
Note that if this fails with a permission error, you may not have added correct public SSH keys of a repo associated to an account that has access to the repo you wish to clone. The other possibility is an issue with the config file, look in ~/.ssh/config and make sure all is correct.

4. Create an environment file for docker to use:
The repository contains a sample environment file look for `./.env.sample` in the root of the repository you cloned in the step above. You can use this file as a template to create an environment file that will be used. Assuming you are in the root of the repository clone, follow along
`
cp ./.env.sample ./.env
`
All the values should be changed to your liking, use vi or nano. Publicly accessible servers should have strong passwords! The DJANGO_SECRET_KEY can be generated by the system using the steps below:
`
docker-compose run --rm app sh -c "python -c 'from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())'"
`

5. Run the dockerized container:
For the first time run the system with logging to the terminal and test navigating to the site via IP address or domain name you may have associated with EC2 instance
`
docker-compose -f docker-compose-deploy.yml up
`
Look for errors in the streaming logs. Try to access the the server through a web browser.
You should be able to hit SERVER_IP:PORT/admin if the EC2 instance is configured to allow this.

TROUBLESHOOTING: Recall the security measures on the EC2 instance - do they allow all IP addresses, is yours one of the ones allowed? How about the TCP port -  are you using 443 for SSL, plain 80 for HTTP, or 8000 the development port?

You may also want to launch the server without the streaming logs
`
docker-compose -f docker-compose-deploy.yml up
`